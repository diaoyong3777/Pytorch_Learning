"""
    1、学会从pytorch下载数据集
    2、会看官方文档 https://docs.pytorch.org/vision/stable/datasets.html

    扩展知识：
    - CIFAR-10(170M)包含10个类别的60000张32x32彩色图像，每个类别6000张。训练集(50000张图像)。测试集(10000张图像)
    - 设置TensorBoard显示更多图像：将终端命令改为 tensorboard --logdir="logs_download" --samples_per_plugin=images=10000
    这样可以在TensorBoard中显示最多10000张图像，解决显示不全的问题
    - 小技巧：crtl+单击，还可以查看数据集的详情，可以直接复制下载链接本地下载，不用解压，直接放到位置上代码自己会处理

"""
# 导入torchvision库，包含常用的数据集、模型架构和图像转换
import torchvision
# 导入TensorBoard的SummaryWriter，用于记录和可视化数据
from torch.utils.tensorboard import SummaryWriter

# 定义数据转换管道，将图像转换为PyTorch张量(tensor)格式
dataset_transform = torchvision.transforms.Compose([
    torchvision.transforms.ToTensor()  # 将PIL图像或numpy数组转换为tensor，并自动归一化到[0,1]范围
])

# 加载CIFAR-10训练数据集
# CIFAR-10包含10个类别的60000张32x32彩色图像，每个类别6000张
train_set = torchvision.datasets.CIFAR10(
    root="./dataset",  # 数据集下载和保存的根目录
    train=True,  # 加载训练集(50000张图像)，如果为False则加载测试集(10000张图像)
    transform=dataset_transform,  # 对图像应用定义好的转换操作
    download=True  # 如果数据集不存在则自动下载
)

# 加载CIFAR-10测试数据集
test_set = torchvision.datasets.CIFAR10(
    root="./dataset",  # 数据集下载和保存的根目录
    train=False,  # 加载测试集(10000张图像)
    transform=dataset_transform,  # 对图像应用相同的转换操作
    download=True  # 如果数据集不存在则自动下载
)


print(test_set[0])                # 打印测试集第一个样本的信息
print(test_set.classes)           # 打印CIFAR-10的10个类别名称

## 以下是被注释掉的调试代码：【不转为tensor可以进行展示】
# img, target = test_set[0]         # 获取第一个样本的图像和标签
# print(img)                        # 打印图像张量
# print(target)                     # 打印数字标签(0-9)
# print(test_set.classes[target])   # 打印对应的类别名称
# img.show()                        # 显示图像(需要GUI环境)


# 创建TensorBoard的SummaryWriter对象，日志将保存在"logs_load_data"目录中
writer = SummaryWriter("logs_download")

# 循环10次，处理测试集的前10个样本
for i in range(10):
    # 从测试集中获取第i个样本的图像和标签
    # img: 经过ToTensor转换后的图像张量，形状为[3, 32, 32]，值范围[0,1]
    # target: 整型标签，范围0-9，对应10个类别
    img, target = test_set[i]

    # 将图像添加到TensorBoard中
    # "test_set": 图像在TensorBoard中显示的分类标签
    # img: 要显示的图像张量
    # i: 全局步数(step)，用于在TensorBoard中区分不同步骤的图像
    writer.add_image("test_set", img, i)

# 关闭SummaryWriter，确保所有数据都写入磁盘
writer.close()


# D:\Anaconda3\envs\study\python.exe C:\Users\dy\Desktop\小土堆\实战\train.py
# 训练数据集的长度为：50000
# 测试数据集的长度为：10000
# -------第 1 轮训练开始-------
# 训练次数：100, Loss: 2.2926294803619385
# 训练次数：200, Loss: 2.27976655960083
# 训练次数：300, Loss: 2.23779559135437
# 训练次数：400, Loss: 2.1268506050109863
# 训练次数：500, Loss: 2.032357931137085
# 训练次数：600, Loss: 2.0013718605041504
# 训练次数：700, Loss: 2.004652500152588
# 整体测试集上的Loss: 314.4508602619171
# 整体测试集上的正确率: 0.2775999903678894
# 模型已保存
# -------第 2 轮训练开始-------
# 训练次数：800, Loss: 1.861778736114502
# 训练次数：900, Loss: 1.8519508838653564
# 训练次数：1000, Loss: 1.8896912336349487
# 训练次数：1100, Loss: 1.9522901773452759
# 训练次数：1200, Loss: 1.715741515159607
# 训练次数：1300, Loss: 1.6569229364395142
# 训练次数：1400, Loss: 1.7132304906845093
# 训练次数：1500, Loss: 1.7930811643600464
# 整体测试集上的Loss: 298.4305227994919
# 整体测试集上的正确率: 0.31220000982284546
# 模型已保存
# -------第 3 轮训练开始-------
# 训练次数：1600, Loss: 1.7420538663864136
# 训练次数：1700, Loss: 1.6512209177017212
# 训练次数：1800, Loss: 1.905305027961731
# 训练次数：1900, Loss: 1.7150237560272217
# 训练次数：2000, Loss: 1.932278037071228
# 训练次数：2100, Loss: 1.5374176502227783
# 训练次数：2200, Loss: 1.4796390533447266
# 训练次数：2300, Loss: 1.8105276823043823
# 整体测试集上的Loss: 268.70003592967987
# 整体测试集上的正确率: 0.3779999911785126
# 模型已保存
# -------第 4 轮训练开始-------
# 训练次数：2400, Loss: 1.732667326927185
# 训练次数：2500, Loss: 1.368874430656433
# 训练次数：2600, Loss: 1.5729833841323853
# 训练次数：2700, Loss: 1.6944572925567627
# 训练次数：2800, Loss: 1.4979982376098633
# 训练次数：2900, Loss: 1.6092380285263062
# 训练次数：3000, Loss: 1.3761017322540283
# 训练次数：3100, Loss: 1.5234707593917847
# 整体测试集上的Loss: 264.46810138225555
# 整体测试集上的正确率: 0.3901999890804291
# 模型已保存
# -------第 5 轮训练开始-------
# 训练次数：3200, Loss: 1.3640960454940796
# 训练次数：3300, Loss: 1.4345886707305908
# 训练次数：3400, Loss: 1.4621926546096802
# 训练次数：3500, Loss: 1.5445516109466553
# 训练次数：3600, Loss: 1.5764330625534058
# 训练次数：3700, Loss: 1.3272403478622437
# 训练次数：3800, Loss: 1.3095611333847046
# 训练次数：3900, Loss: 1.454175591468811
# 整体测试集上的Loss: 258.3073983192444
# 整体测试集上的正确率: 0.4090000092983246
# 模型已保存
# -------第 6 轮训练开始-------
# 训练次数：4000, Loss: 1.4199751615524292
# 训练次数：4100, Loss: 1.4393970966339111
# 训练次数：4200, Loss: 1.5062646865844727
# 训练次数：4300, Loss: 1.246225118637085
# 训练次数：4400, Loss: 1.1399918794631958
# 训练次数：4500, Loss: 1.3695719242095947
# 训练次数：4600, Loss: 1.4584300518035889
# 整体测试集上的Loss: 247.09286308288574
# 整体测试集上的正确率: 0.42899999022483826
# 模型已保存
# -------第 7 轮训练开始-------
# 训练次数：4700, Loss: 1.3534632921218872
# 训练次数：4800, Loss: 1.5300178527832031
# 训练次数：4900, Loss: 1.4069095849990845
# 训练次数：5000, Loss: 1.3675442934036255
# 训练次数：5100, Loss: 1.0213861465454102
# 训练次数：5200, Loss: 1.3035584688186646
# 训练次数：5300, Loss: 1.2526648044586182
# 训练次数：5400, Loss: 1.4060018062591553
# 整体测试集上的Loss: 233.4694426059723
# 整体测试集上的正确率: 0.4634000062942505
# 模型已保存
# -------第 8 轮训练开始-------
# 训练次数：5500, Loss: 1.236825942993164
# 训练次数：5600, Loss: 1.2426429986953735
# 训练次数：5700, Loss: 1.1912448406219482
# 训练次数：5800, Loss: 1.256054162979126
# 训练次数：5900, Loss: 1.3192284107208252
# 训练次数：6000, Loss: 1.571061372756958
# 训练次数：6100, Loss: 1.023866057395935
# 训练次数：6200, Loss: 1.0950831174850464
# 整体测试集上的Loss: 220.00995755195618
# 整体测试集上的正确率: 0.4966999888420105
# 模型已保存
# -------第 9 轮训练开始-------
# 训练次数：6300, Loss: 1.420297384262085
# 训练次数：6400, Loss: 1.1341845989227295
# 训练次数：6500, Loss: 1.534043550491333
# 训练次数：6600, Loss: 1.1308542490005493
# 训练次数：6700, Loss: 1.0856796503067017
# 训练次数：6800, Loss: 1.184607744216919
# 训练次数：6900, Loss: 1.113396167755127
# 训练次数：7000, Loss: 0.9652591943740845
# 整体测试集上的Loss: 210.83764481544495
# 整体测试集上的正确率: 0.5180000066757202
# 模型已保存
# -------第 10 轮训练开始-------
# 训练次数：7100, Loss: 1.2558116912841797
# 训练次数：7200, Loss: 0.907140851020813
# 训练次数：7300, Loss: 1.066820740699768
# 训练次数：7400, Loss: 0.8642097115516663
# 训练次数：7500, Loss: 1.2645798921585083
# 训练次数：7600, Loss: 1.253187656402588
# 训练次数：7700, Loss: 0.9245949387550354
# 训练次数：7800, Loss: 1.237595558166504
# 整体测试集上的Loss: 204.34516912698746
# 整体测试集上的正确率: 0.5325000286102295
# 模型已保存
#
# 进程已结束，退出代码为 0